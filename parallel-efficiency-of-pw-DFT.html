<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>
    
      Parallel efficiencies of (small) plane wave DFT calculations | Bonan Zhu
    
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="https://zhubonan.github.io/feed.xml" title="Bonan Zhu">
  <!-- Use RSS-2.0 -->
  <!--<link href="/rss-feed.xml" type="application/rss+xml" rel="alternate" title="Bonan Zhu | Computational Materials Scientist at UCL"/>
  //-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quattrocento+Sans">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      });
  </script>
  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>

  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Parallel efficiencies of (small) plane wave DFT calculations | Bonan Zhu</title>
<meta name="generator" content="Jekyll v4.3.2">
<meta property="og:title" content="Parallel efficiencies of (small) plane wave DFT calculations">
<meta name="author" content="Bonan Zhu">
<meta property="og:locale" content="en_US">
<meta name="description" content="Plane wave DFT calculations are often known as “cubic-scaling” where the cost grows as the number of atoms (more precisely the number of electrons) cubed. Thankfully, they can be parallelised over many (possibly very large number of cores) to accelerate the calculations. This is often done at multiple levels: the plane wave coefficients, the bands and the k points.">
<meta property="og:description" content="Plane wave DFT calculations are often known as “cubic-scaling” where the cost grows as the number of atoms (more precisely the number of electrons) cubed. Thankfully, they can be parallelised over many (possibly very large number of cores) to accelerate the calculations. This is often done at multiple levels: the plane wave coefficients, the bands and the k points.">
<link rel="canonical" href="https://zhubonan.github.io/parallel-efficiency-of-pw-DFT">
<meta property="og:url" content="https://zhubonan.github.io/parallel-efficiency-of-pw-DFT">
<meta property="og:site_name" content="Bonan Zhu">
<meta property="og:image" content="https://zhubonan.github.io/mountain-everest.jpg">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-07-14T00:00:00+00:00">
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://zhubonan.github.io/mountain-everest.jpg">
<meta property="twitter:title" content="Parallel efficiencies of (small) plane wave DFT calculations">
<meta name="twitter:site" content="@1stbz">
<meta name="twitter:creator" content="@Bonan Zhu">
<meta name="google-site-verification" content="OpfWQC0z6rWcc-gHcJ6347BJqO7OPIcowyhcDSYKCXs">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Bonan Zhu"},"dateModified":"2021-07-14T00:00:00+00:00","datePublished":"2021-07-14T00:00:00+00:00","description":"Plane wave DFT calculations are often known as “cubic-scaling” where the cost grows as the number of atoms (more precisely the number of electrons) cubed. Thankfully, they can be parallelised over many (possibly very large number of cores) to accelerate the calculations. This is often done at multiple levels: the plane wave coefficients, the bands and the k points.","headline":"Parallel efficiencies of (small) plane wave DFT calculations","image":"https://zhubonan.github.io/mountain-everest.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhubonan.github.io/parallel-efficiency-of-pw-DFT"},"url":"https://zhubonan.github.io/parallel-efficiency-of-pw-DFT"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <div class="container">
      <header class="header">
  <h3 class="header-title">
    <a href="/">Bonan Zhu</a>
    <small class="header-subtitle">Computational Materials Scientist at UCL</small>
    <div class="menu">
  <nav class="menu-content">
    
      <a href="/about.html">About me</a>
    
      <a href="/posts.html">Posts</a>
    
      <a href="/codes.html">Codes</a>
    
      <a href="/publications.html">Publications</a>
    
      <a href="/contact.html">Contact</a>
    
  </nav>
  <nav class="social-icons">
    
  
  
    <a href="https://www.github.com/zhubonan" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  
  
    <a href="https://twitter.com/1stbz" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  

  
  
    <a href="/feed.xml"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  

  </nav>
</div>

  </h3>
</header>

      <div class="content-container">
        <h1>
  Parallel efficiencies of (small) plane wave DFT calculations
</h1>

  <img src="/assets/img/mountain-everest.jpg">

<article>
  <p>Plane wave DFT calculations are often known as “cubic-scaling” where the cost grows as the number of atoms (more precisely the number of electrons) cubed.
Thankfully, they can be parallelised over many (possibly very large number of cores) to accelerate the calculations.
This is often done at multiple levels: the plane wave coefficients, the bands and the k points.</p>

<p>A frequent question one may ask when running calculations is: how many cores should I use?
Obviously, using more cores <em>should</em> make the calculation faster, but it also increases the time spend on inter-process communications, causing the parallel efficiency to drop with increasing core counts.
It not uncommon to see examples where a single calculation can be parallelised over thousands of cores for a supercomputer with relatively small drop on the efficiency.
However, the rate of reduction in the parallel efficiency is also highly dependent on the size of the system: those of hard problems (e.g. more atoms) drop much slower than simple and small systems.</p>

<p>If there are many calculations to run through, rather than getting the result of each calculation quickly, it can be more efficient to run multiple calculations in parallel, each using a smaller number cores to achieve a higher throughput.</p>

<p>Below are some test results for a 28-atom structure using the code <a href="http://www.castep.org">CASTEP</a> with increasing number of cores while maintaining a full population of single compute node with 24 cores.
This is a “small” calculation with only 340 eV plane wave cut off energy and 4 kpoints, and 106 bands.</p>

<p><img src="/assets/img/throughput-castep-full-occ.png" alt="Test result"></p>

<p>As one may expect, the parallelisation efficiency drops with increasing number of cores.
By running 24 cores jobs instead of 1 cores, the overall throughput has dropped to about 80 %, while running six 4-core jobs has only a 5% lost in efficiency.
While running many “small” jobs does increase the overall throughput, it comes at the cost of very long “time-to-result” for each calculation.
In reality, computing clusters often have cap of run times, and having long-running time for each calculation risks having unfinished ones getting killed, wasting a certain amount of time and resources.
This also means that the aftermath of having any kind of node failure will be higher, as calculations have longer turnaround.</p>

<p>One important note is that if the node is not fully occupied in the tests, the benefit of running smaller but and many jobs can be significantly exaggerated, as shown in the plot below.</p>

<p><img src="/assets/img/throughput-castep-partial-occ.png" alt="Test result with partial occupation"></p>

<p>Several factors could cause this. First, under populating the node means each MPI process has access to more memory and communication bandwidth. 
Second, modern CPUs often <a href="https://en.wikipedia.org/wiki/Intel_Turbo_Boost">boosts the frequencies</a> when only a few cores are active to be able to utilise the thermal headroom left by the idling ones.</p>


</article>

  <span class="post-date">
  Written on
  
  July
  14th,
  2021
  by
  
    Bonan Zhu
  
</span>



  <div class="post-date">Feel free to share!</div>
<div class="sharing-icons">
  <a href="https://twitter.com/intent/tweet?text=Parallel%20efficiencies%20of%20(small)%20plane%20wave%20DFT%20calculations&amp;url=/parallel-efficiency-of-pw-DFT" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=/parallel-efficiency-of-pw-DFT&amp;title=Parallel%20efficiencies%20of%20(small)%20plane%20wave%20DFT%20calculations" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
</div>



  <div class="related">
  <h1>You may also enjoy:</h1>
  
  <ul class="related-posts">
    
      
        
        
      
    
      
        
          <li>
            <h3>
              <a href="/internet-for-login-nodes">
                Access the internet (for good) on login nodes behind firewalls
                <!--<img src="https://zhubonan.github.io/images/">-->
                <!--<small>November 19, 2022</small>-->
              </a>
            </h3>
          </li>
          
        
      
        
        
      
        
          <li>
            <h3>
              <a href="/hello-world">
                Hello World!
                <!--<img src="https://zhubonan.github.io/images/">-->
                <!--<small>July 13, 2021</small>-->
              </a>
            </h3>
          </li>
          
        
      
    
      
        
        
      
        
          <li>
            <h3>
              <a href="/aiida-2.0-and-compression">
                enabling data compression in AiiDA 2.0
                <!--<img src="https://zhubonan.github.io/images/">-->
                <!--<small>June 9, 2022</small>-->
              </a>
            </h3>
          </li>
          
        
      
        
          <li>
            <h3>
              <a href="/DFT-parallelisation-rule-of-thumb">
                DFT parallelisation rule of thumb
                <!--<img src="https://zhubonan.github.io/images/">-->
                <!--<small>February 15, 2022</small>-->
              </a>
            </h3>
          </li>
          
        
      
    
  </ul>
</div>




      </div>
      <footer class="footer">
  
  
  
    <a href="https://www.github.com/zhubonan" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  
  
    <a href="https://twitter.com/1stbz" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  

  
  
    <a href="/feed.xml"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  

  <div class="footer-description"><a href="/">Bonan Zhu | Computational Materials Scientist at UCL by Bonan Zhu</a></div>
</footer>

    </div>
  </body>
</html>
